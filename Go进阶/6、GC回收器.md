# GC

Go语言中采用STW（Stop The World）方式

Golang每个版本基本上都会对GC进行优化，从Golang1.5开始支持并发(concurrent )收集,从1.8版本已经把

STW时间优化到了100微妙通常只需要10微妙以下且在1.10版本时再次优化减少GC对CPU占用

## 触发GC

Go语言中GC是自动运行的，在下列情况下会触发GC

- 1、当需要申请内存时，发现GC是上次GC两倍时会触发
- 2、每2min 自动运行一次GC

## GC运行流程

**Go V1.3之前的标记-清除**：

暂停---标记---清除---恢复暂停

1.暂停业务逻辑，找到不可达的对象，和可达对象。
2.开始标记，程序找出它所有可达的对象，并做上标记。
3.标记完了之后，然后开始清除未标记的对象。
4.停止暂停，让程序继续跑。然后循环重复这个过程，直到process程序生命周期结束。

标记-清除的缺点：
STW（stop the world）：让程序暂停，程序出现卡顿
标记需要扫描整个heap
清除数据会产生heap碎片

为了减少STW的时间，后来对上述的第三步和第四步进行了替换。

## GC调优

- 1、小对象复用,局部变量尽量少声明，多个小对象可以放入到结构体,方便GC扫描

- 2、少用string的"+"

在runtime包 下mg.go中明确的说明了Golang的GC的解释



# 三色标记法

三色标记法是一种用于垃圾回收的算法，主要用于标记和清除不再使用的对象。它将对象分为三种颜色：白色、灰色和黑色。以下是三色标记法的基本步骤：

1. **初始化**：所有对象都标记为白色。
2. 标记阶段
   - 将根对象标记为灰色。
   - 处理灰色对象，将其引用的白色对象标记为灰色，并将当前灰色对象标记为黑色。
3. **清除阶段**：删除所有仍然是白色的对象。



go语言，怎么使系统具有扩展性、稳定性、高可用高并发

**扩展性**：
	使用接口和组合的方式设计代码，便于扩展和替换底层实现
	使用依赖注入的方式，将依赖关系解耦，方便替换组件
	使用反射机制，动态地加载和实例化对象，增强代码的灵活性
	使用配置文件或数据库存储配置信息，方便对系统进行配置和调整
**稳定性**：
	编写健壮的代码，对异常情况进行处理和恢复
	使用日志系统记录系统运行情况，及时发现和解决问题
	使用断路器模式，当系统出现故障时，能够快速切换到备用系统，保证系统的可用性
	使用容器化技术，将应用程序封装在容器中，保证应用程序的稳定性和可靠性
**高可用高并发**：
	使用分布式架构，将系统拆分成多个微服务，提高系统的可用性和并发能力
	使用负载均衡技术，将请求分散到多个服务器上，提高系统的并发能力和容错性
	使用缓存技术，将热点数据缓存到缓存系统中，减轻数据库的负载，提高系统的并发能力
	使用异步编程技术，将任务分发到多个协程中，提高系统的并发能力和性能

